<!-- src/app/games/coinflip/coinflip.component.html -->
<div class="conteneur section-jeu">
  <div class="panneau">
    <h2 class="titre-page">Pile ou Face</h2>
    <p class="sous-texte">Mise minimale : <strong>{{ minBet }}</strong> crÃ©dits.</p>

    <div class="coin-stage" style="position:relative;">
      <!-- Animation / rendu -->
      <div class="coin-anim"
           [class.en-attente]="enCours && !resolutionEnCours"
           [class.en-resolution]="resolutionEnCours"
           [style.--target-rot]="targetRot"
           [style.--rot-dur]="rotateDuration"
           [style.--base-rot]="baseRotDeg + 'deg'">
        <div class="coin" [class.static]="!enCours && !resolutionEnCours">
          <div class="face front">PILE</div>
          <div class="face back">FACE</div>
        </div>
        <div class="shadow"></div>
      </div>

      <!-- ðŸ”’ Overlay dâ€™aperÃ§u quand pas connectÃ© -->
      <div *ngIf="!isLoggedIn" class="lock-overlay">
        <div class="lock">ðŸ”’</div>
        <div>Connecte-toi pour jouer</div>
        <a routerLink="/login" class="cta">Se connecter</a>
      </div>
    </div>

    <div class="mb-12">
      <label class="libelle">Mise (crÃ©dits)</label>
      <input class="champ" type="number" [(ngModel)]="mise" [attr.min]="minBet" [max]="maxBet" [disabled]="enCours || !isLoggedIn">
      <small class="sous-texte">Solde : <strong>{{ currentBalance ?? 'â€”' }}</strong></small>
      <small *ngIf="mise && mise < minBet" style="display:block;color:#ff9b9b;">La mise doit Ãªtre â‰¥ {{ minBet }}.</small>
    </div>

    <div class="mb-12">
      <label class="libelle">Choisis</label>
      <div class="d-flex gap-12">
        <label><input type="radio" name="choix" [(ngModel)]="choix" value="pile" [disabled]="enCours || !isLoggedIn"> Pile</label>
        <label><input type="radio" name="choix" [(ngModel)]="choix" value="face" [disabled]="enCours || !isLoggedIn"> Face</label>
      </div>
    </div>

    <div class="boutons">
      <button (click)="jouer()"
              [disabled]="!isLoggedIn || enCours || !mise || mise < minBet"
              class="bouton bouton--primaire">
        Jouer
      </button>
      <a [routerLink]="['/home']" class="bouton">Retour</a>
    </div>

    <div *ngIf="message || error" class="panneau mt-12">
      <div *ngIf="lastResult">
        <p><strong>RÃ©sultat :</strong> {{ lastResult?.outcome | uppercase }}</p>
        <p *ngIf="lastResult?.win" style="color:#34d399">Tu as gagnÃ© ! +{{ lastResult?.montantGagne }} crÃ©dits.</p>
        <p *ngIf="lastResult && !lastResult.win" style="color:#f87171">Tu as perdu. -{{ lastResult?.montantJoue }} crÃ©dits.</p>
        <p>Solde : <strong>{{ lastResult?.solde }}</strong></p>
      </div>
      <p *ngIf="error" style="color:#ff9b9b">{{ error }}</p>
    </div>

    <div class="mt-12 sous-texte">
      <small>Gain net = (2Ã—mise) âˆ’ mise quand tu gagnes.</small>
    </div>
  </div>

  <div class="panneau mt-12">
    <app-game-history-list [game]="'coinflip'" [limit]="5"></app-game-history-list>
  </div>
</div>
