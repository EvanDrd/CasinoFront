<!-- en-tête -->
<h2 *ngIf="state as s">Table {{ s.id }}</h2>
<p *ngIf="!state">Chargement…</p>

<div *ngIf="state as s">
  <section class="dealer card">
    <h3>Croupier</h3>

    <!-- pendant PLAYING: on montre 1 carte visible + une face cachée -->
    <ng-container *ngIf="s.phase === 'PLAYING'; else dealerRevealed">
      <div class="cards">
<span class="card" *ngIf="s.dealer?.cards?.length">
  {{ asCardText(s.dealer.cards[0].rank, s.dealer.cards[0].suit) }}
</span>
        <span class="card back">🂠</span>
      </div>
      <small>Total: ??</small>
    </ng-container>

    <!-- après dealer_turn/payout: montrer toute la main et le total -->
    <ng-template #dealerRevealed>
      <div class="cards">
        <span class="card" *ngFor="let c of s.dealer?.cards">{{ asCardText(c.rank, c.suit) }}</span>
      </div>
      <small>Total: {{ s.dealer?.total }}</small>
    </ng-template>
  </section>

  <!-- SEATS -->
  <section class="seats">
    <article class="seat" *ngFor="let seat of s.seats">
      <header>
        <strong>Siège {{ seat.index }}</strong>
        <small *ngIf="seat.email">{{ seat.email }}</small>
        <small *ngIf="!seat.email">Libre</small>
      </header>

      <div class="cards" *ngIf="seat.hand?.cards?.length">
        <span class="card" *ngFor="let c of seat.hand.cards">{{ asCardText(c.rank, c.suit) }}</span>
      </div>

      <p *ngIf="seat.hand">Total: {{ seat.hand.total }} • Mise: {{ seat.hand.bet || 0 }}</p>

      <!-- Résultat dernière manche si dispo -->
      <div class="result"
           *ngIf="s.lastPayouts as pays">
        <ng-container *ngFor="let p of pays">
          <div *ngIf="p.seat === seat.index">
            <strong *ngIf="p.outcome==='WIN'">✅ +{{ p.credit - (p.bet) }}</strong>
            <strong *ngIf="p.outcome==='BLACKJACK'">🖤 +{{ p.credit - (p.bet) }} (Blackjack)</strong>
            <strong *ngIf="p.outcome==='PUSH'">➖ 0 (Push)</strong>
            <strong *ngIf="p.outcome==='LOSE'">❌ -{{ p.bet }}</strong>
          </div>
        </ng-container>
      </div>

      <!-- actions rapides (à adapter selon ton guard isMySeat etc.) -->
      <div class="actions" *ngIf="mySeat()?.index === seat.index">
        <button (click)="hit()"    [disabled]="!myTurn()">Hit</button>
        <button (click)="stand()"  [disabled]="!myTurn()">Stand</button>
        <button (click)="double()" [disabled]="!myTurn()">Double</button>
        <button (click)="surrender()" [disabled]="!myTurn()">Surrender</button>
      </div>

      <button *ngIf="!seat.email" (click)="sit(seat.index)">S’asseoir ici</button>
    </article>
  </section>

  <!-- zone mise -->
  <section class="betting" *ngIf="s.phase==='BETTING' && mySeat() as me">
    <input type="number" [(ngModel)]="betAmount" min="1">
    <button (click)="bet()">Miser</button>
    <small *ngIf="s.deadline">Temps restant: {{ (s.deadline - Date.now())/1000 | number:'1.0-0' }}s</small>
  </section>
</div>
